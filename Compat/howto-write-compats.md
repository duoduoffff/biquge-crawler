# 插件编写指南

## 这是干嘛的？

一个能够在笔趣阁自动爬取各种小说的 Python3 软件。

## 有什么优点？

1. 模块化，笔趣阁的各种镜像站前端页面不同，但大概率用的同一套代码，前端的路由也大差不差，一个镜像站的适配插件稍微改改就能用于别的镜像站，提高爬取效率。
2. 自动化，爬取过程无需用户干预，几乎不需要用户界面。
3. 智能化，根据域名智能加载合适的插件，在受插件支持的各路网站上，最终用户都无需关心域名问题。
4. 二次开发容易，可以作为库调用，或者作为命令行软件和系统 shell 整合，实在不会用的话，直接跑起来也没问题。

## 插件规范

每个镜像站的适配工具都是单独的一个 Python3 文件，可以取任意的名字，放在项目目录的 Compat 文件夹中，直接运行这个文件是不起作用的，只能够通过主程序 app.py 加载它。

### 必须有的几个函数

主程序在加载软件时，会对以下必须函数进行校验，不存在的话则报错或跳过加载：

- metadata() -> 用于声明插件基本信息
    - 变量 name -> 插件的友好名称，会显示在交互终端中
    - compatDomain -> 插件生效的网站域名
    - protocol -> 协议名，一般为 https，这个声明现阶段暂时不生效的
    - author -> 作者名
    - authorEmail -> 作者邮箱
    - splitChapterList -> 布尔值，设为真表明该网站当中小说的章节名称分散在多页，需要分页获取
    - mobileLayout -> 布尔值，声明网站是否为移动视图，这个声明现阶段暂时不生效的
- getChaptersOnPage(html) -> 用于获取网页中的章节列表。
    - 传入的参数是 bs4 的网页对象。
    - 主程序能够处理的格式如下：
        ```json
        [
            {"cur": 9, "total": 14},
            {"name": "玉石之声", "link": "https://m.xxx.com/xxx.html"},
            {"name": "梨花带雨", "link": "https://m.xxx.com/xxx.html"},
            ...,
            {"name": "五爪金龙", "link": "https://m.xxx.com/xxx.html"}
        ]
        ```
        其中，数组中的第一个是当前分页和所有分页信息，即便只有一页，也必须带上此元素，否则会导致拼接错误！
- getChapterCtt(html) -> 从网页中取得章节正文。
    - 传入的参数是 bs4 的网页对象。
- getNovelName(html) -> 从网页中取得小说名称。
    - 传入的参数是 bs4 的网页对象。
- compat() -> 返回部分变量和 url 模板
    - 如果被爬取的网站章节列表不需要翻页，则 chapterListSplitUrl 传一个正常的 url。假如需要翻页，页码的位置用一个美元符号 `$` 代替，系统会处理。
    - 必须以字典的形式传回以下的项：
        ```json
        {
            "urlBase": urlBase,
            "metadataUrl": metadataUrl,
            "chapterListSplitUrl": chapterListSplitUrl,
        }
        ```
    
以上函数必须实现到文件根中，不能套在类或者方法里，就直接在文件中 写入 def 即可。

另外的函数不做要求，可以按照自己的操作习惯来写，但是建议自己的函数起名时加一个 Impl 以示区分。
